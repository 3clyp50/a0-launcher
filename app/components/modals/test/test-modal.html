<html>
<head>
  <title>Test Modal</title>

  <!-- Intentionally RELATIVE import: this validates the component loader's inline-module rewriting -->
  <script type="module">
    import "./test-store.js";
  </script>
</head>
<body>
  <div x-data>
    <template x-if="$store.testModal">
      <div class="test-modal-root section" x-destroy="$store.testModal.cleanup?.()">
        <div class="test-modal-header">
          <div>
            <div class="test-modal-title">A0 Component System Smoke Test</div>
            <div class="test-modal-subtitle">
              Validates modals, Alpine store, and loader behavior under Electron <code>file://</code>.
            </div>
          </div>
          <button class="button cancel" @click="closeModal()">Close</button>
        </div>

        <div class="test-modal-grid">
          <div class="test-modal-block">
            <div class="test-modal-block-title">State</div>
            <div class="test-modal-kv">
              <span class="test-modal-k">openedAt</span>
              <span class="test-modal-v" x-text="$store.testModal.openedAt"></span>
            </div>
            <div class="test-modal-kv">
              <span class="test-modal-k">count</span>
              <span class="test-modal-v" x-text="$store.testModal.count"></span>
            </div>
          </div>

          <div class="test-modal-block">
            <div class="test-modal-block-title">Actions</div>
            <div class="buttons-left test-modal-actions">
              <button class="button confirm" @click="$store.testModal.increment()">Increment</button>
              <button class="button" :disabled="$store.testModal.busy" @click="$store.testModal.demoAsync()">
                <span x-show="!$store.testModal.busy">Async demo</span>
                <span x-show="$store.testModal.busy">Working…</span>
              </button>
              <a class="button" href="/components/modals/test/nested-modal.html" data-modal-content>
                Open nested modal
              </a>
            </div>
          </div>
        </div>

        <div class="test-modal-block">
          <div class="test-modal-block-title">Two-way binding</div>
          <input class="test-modal-input" type="text" x-model="$store.testModal.message" placeholder="Type to update store…" />
          <div class="test-modal-subtitle" style="margin-top: var(--spacing-sm);">
            message:
            <code x-text="$store.testModal.message"></code>
          </div>
        </div>

        <div class="test-modal-block">
          <div class="test-modal-block-title">&lt;x-component&gt; recursion</div>
          <x-component path="modals/test/test-widget.html"></x-component>
        </div>

        <div class="test-modal-block">
          <div class="test-modal-block-title">Log</div>
          <div class="test-modal-log">
            <template x-for="(line, idx) in ($store.testModal.log || [])" :key="idx">
              <div class="test-modal-log-line" x-text="line"></div>
            </template>
          </div>
        </div>
      </div>
    </template>
  </div>

  <style>
    .test-modal-root {
      margin: 0;
    }

    .test-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-md);
    }

    .test-modal-title {
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--color-text);
    }

    .test-modal-subtitle {
      margin-top: var(--spacing-xs);
      color: var(--color-text-secondary);
      font-size: 0.9rem;
      line-height: 1.35;
    }

    .test-modal-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-md);
    }

    .test-modal-block {
      padding-bottom: var(--spacing-md);
    }

    @media (min-width: 760px) {
      .test-modal-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .test-modal-block-title {
      font-weight: 600;
      margin-bottom: var(--spacing-sm);
      color: var(--color-primary);
    }

    .test-modal-kv {
      display: flex;
      justify-content: space-between;
      gap: var(--spacing-md);
      padding: var(--spacing-xs) 0;
      border-bottom: 1px solid var(--color-border);
      font-family: var(--font-family-code);
      font-size: 0.9rem;
    }

    .test-modal-k {
      color: var(--color-text-secondary);
    }

    .test-modal-v {
      color: var(--color-text);
      overflow-wrap: anywhere;
    }

    .test-modal-actions {
      gap: var(--spacing-sm);
      flex-wrap: wrap;
    }

    .test-modal-input {
      width: 100%;
      background: var(--color-input);
      border: 1px solid var(--color-border);
      color: var(--color-text);
      border-radius: 8px;
      padding: 0.6rem 0.8rem;
      font-family: var(--font-family-main);
    }

    .test-modal-input:focus {
      outline: none;
      border-color: var(--color-highlight);
      background: var(--color-input-focus);
    }

    .test-modal-log {
      border: 1px solid var(--color-border);
      border-radius: 8px;
      background: var(--color-background);
      padding: var(--spacing-md);
      max-height: 220px;
      overflow: auto;
      font-family: var(--font-family-code);
      font-size: 0.85rem;
    }

    .test-modal-log-line {
      padding: 2px 0;
      color: var(--color-text);
      opacity: 0.95;
    }
  </style>
</body>
</html>


